---
layout: post
title: "JNI入门 一个JNI的HelloWorld 程序"
description: ""
category: java
subhead: ''
tags: [.net,  java,  JNI]

---

JNI是java本地编程接口。是 `Java Native Interface`的英文缩写。他能够使java代码与用其他编程语言编写的应用程序和库进行互操作。（其他编程语言大多是c,c++和汇编语言。）


下面来写一个间的HelloWorld程序。首先启动Eclipse 新建一个java工程：


![](http://dl.iteye.com/upload/attachment/564560/cbe05acb-9fce-375c-be21-4caa92c964f4.png)

新建一个class 注意：必须在类中声明一个`native`方法:

    package org.gunct;
    public class JniDemo
    {
        /**
         * sayHello
         * 使用JNI时 在java类中必须声明一个native方法
         * 在java中不用实现这个方法，只声明就行了
         * 
         */
        public native void sayHello();
        public static void main(String[] args)
        {
        }
    }

 

接下来是c/c++的本地代码实现了:
写在c/c++中 sayHello()函数的声明。这里需要用到jdk提供的一个工具`javah.exe`,在jdk安装目录/bin下面。

![](http://dl.iteye.com/upload/attachment/564562/f66b22dd-2443-3fba-8589-d77f96dd2c5b.png)

下进行下面操作时，确保你的系统已经设置好了java的环境变量,使用javah命令生成包含c/c++的头文件

javah的用法:

![](http://dl.iteye.com/upload/attachment/564564/89e922d9-c421-3262-b5b0-222c5b59f06e.png)

首先进入刚才写的JniDemo对应的class路径
然后运行命令


![](http://dl.iteye.com/upload/attachment/564566/cdda1226-118d-3c3d-805a-1b519785108a.png)

回到目录会发现已经生成好了头文件


![](http://dl.iteye.com/upload/attachment/564568/3cb5f3a3-cac2-368a-9330-c9736a9bf0dc.png)

接下来启动Microsoft Visual Studio新建一个win32控制台项目


![](http://dl.iteye.com/upload/attachment/564570/a7be941f-093b-3508-9303-a936ecd6cf95.png)

为项目创建dll


![](http://dl.iteye.com/upload/attachment/564572/e6b90e97-59ce-346a-9255-cc1be5153abc.png)

创建C++文件


![](http://dl.iteye.com/upload/attachment/564574/dc342acd-d3c4-342b-8c7b-cf84be4ca981.png)

将刚才生成的头文件剪切到c++项目中，因为在c++编译过程中要用到jdk提供的头文件jni.h（jdk目录/include下面）和jni\_md.h（jdk目录/include/win32下面），把这两个文件也拷贝到c++项目中。

![](http://dl.iteye.com/upload/attachment/564576/872d3f60-2e11-3e18-8f82-1543196d243a.png)

回到Microsoft Visual Studio项目中，将这三个头文件添加到项目中


![](http://dl.iteye.com/upload/attachment/564578/4480ae34-7ed6-304a-8105-c56d74268832.png)\
 

[](http://p.blog.csdn.net/images/p_blog_csdn_net/ol_soft/474687/o_image_21.png)
接下来编写sayHello.cpp 代码如下：


    #include <iostream>
    #include "org_gunct_JniDemo.h"
    using namespace std;
    //重写方法
    JNIEXPORT void JNICALL Java_org_gunct_JniDemo_sayHello(JNIEnv * env, jobject obj)
        cout<<"Hello World"<<endl;
    }

编译后在Release目录看到jniCode.dll文件


![](http://dl.iteye.com/upload/attachment/564580/f90152f7-7081-30fe-b68b-4367f59121f0.png)

将这个文件拷贝到C:/WINDOWS/system32下面

编写代码：

    package org.gunct;
    public class JniDemo
    {
        /**
         * sayHello
         * 使用JNI时 在java类中必须声明一个native方法
         * 在java中不用实现这个方法，只声明就行了
         */
        public native void sayHello();
        public static void main(String[] args)
        {
            System.loadLibrary("jniCode");
            JniDemo d = new JniDemo();
            d.sayHello();
        }
    }


运行后输出结果：

![](http://dl.iteye.com/upload/attachment/564582/76b20451-4f0e-3c1d-b0d7-db07a486b47e.png)

使用JNI的弊端 ：

由于c/c++不是跨平台的，所以使用JNI后的java程序就不能跨平台了。

Java是强类型的语言，c/c++不是。
所以应该尽量少使用JNI。


{% include JB/setup %}