---
layout: post
title: "如何减少计算响应时间"
description: "第二次在并发环境下被HashMap坑"
category: optimization
subhead: ''
tags: [java,optimization,优化,计算,响应]
---

> Premature optimization is the root of all evil.
>
>   　                                       --- Donald Knuth

对于程序优化，我一直采取保守的态度，除非万不得已。但是随着业务的不断发展，程序越来越复杂，代码越写越多，似乎优化的那一天一定会到来。

那么对于一个典型的后台服务接口，我们可以从那些方面入手进行优化呢？

## 接口拆分


### 接口垂直拆分
垂直拆分可以简单理解为微服务化，把一个大而复杂的服务拆分成多个相互独立，职能单一的服务，单独部署。
更细粒度拆分的好处是，能对某个具体的微服务进行特性优化，以最大的投入产出比来解决整个服务的性能。
最容易想到的优化办法是把某个对整体性能有决定性影响的微服务接口进行水平扩容。
垂直拆分还有一个好处是，对于非必须的接口，可以很方便的进行降级处理，把坏影响隔离到核心逻辑外部。

**注意:** 拆分后必定会增加外部接口调用，多少会有些额外开销，但是对于有限几个调用，拆分的还是值得的。

### 接口水平拆分
这里说的水平拆分一定不是把一个服务接口部署更多份，因为这样只能解决服务的容量问题，但是不能减少服务的响应时间。
水平拆分可以简单理解成mapreduce模型，把整个计算逻辑或者数据平均分配到集群中的N个服务器去，然后由一台机器去并发调用并做结果合并。
理论上这种方式能把响应减少到`1/N+合并+调用开销`的时间。

**注意：** 一个问题需要考虑的是，如果并发调用的接口返回的数据量比较大，可能会对合并机器的网络负载和数据序列化(CPU)有一定影响。

## 数据闭环

 

